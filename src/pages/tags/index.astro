---
import Layout from '../../layouts/Layout.astro';

// Busca todos os posts
const allPosts = await Astro.glob('../posts/*.md');

// Processa as tags:
// 1. Mapeia para pegar os arrays de tags de cada post
// 2. 'flat()' junta tudo num √∫nico array
// 3. Filtra valores vazios
const allTags = allPosts
  .map((post) => post.frontmatter.tags)
  .flat()
  .filter(Boolean);

// Conta a ocorr√™ncia de cada tag
const tagCounts = allTags.reduce((acc, tag) => {
  acc[tag] = (acc[tag] || 0) + 1;
  return acc;
}, {});

const uniqueTags = Object.keys(tagCounts);
---

<Layout title="Tags">
    <header class="text-center mb-12">
        <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight mb-4">
            Explorar por <span class="text-blue-600">Tags</span>
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto">
            Navegue pelos t√≥picos espec√≠ficos abordados nos artigos.
        </p>
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {uniqueTags.map((tag) => (
            <a href={`/tags/${tag}`} class="group block bg-white rounded-2xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-all hover:-translate-y-1">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-2xl">üè∑Ô∏è</span>
                    <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full">
                        {tagCounts[tag]} {tagCounts[tag] === 1 ? 'post' : 'posts'}
                    </span>
                </div>
                <h2 class="text-xl font-bold text-slate-800 group-hover:text-blue-600 transition-colors">
                    #{tag}
                </h2>
            </a>
        ))}
    </div>
</Layout>